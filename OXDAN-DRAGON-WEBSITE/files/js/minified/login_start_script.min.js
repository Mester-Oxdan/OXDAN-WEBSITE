function startGoogleLogin(){const e=window.OAUTH_STATE;google.accounts.id.initialize({client_id:"204106058046-1f2lr09dtrsl6f1j26mvmtj8jut7p7tl.apps.googleusercontent.com",callback:handleCredentialResponse,state:e}),google.accounts.id.renderButton(document.getElementById("google-login-btn"),{theme:"outline",size:"large"})}function handleCredentialResponse(e){const t=window.OAUTH_STATE;fetch("/api/oauth_google.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:e.credential,state:t})}).then((e=>e.json())).then((e=>{"success"===e.status?window.location.href="/skip_login":alert("Google login failed: "+e.message)}))}const waitForGoogle=setInterval((()=>{window.google&&google.accounts&&google.accounts.id&&(clearInterval(waitForGoogle),startGoogleLogin())}),50);function delay(e){return new Promise((t=>setTimeout(t,e)))}async function saveUsernameToTextFile(){var e;await delay(4e3),e="skip_login",window.location.href={skip_login:"/skip_login"}[e]}function handleSuccessfulLogin(){saveUsernameToTextFile()}var widgetId1;$(document).ready((function(){$("#showPasswordLabel").on("click",(function(){var e=$("#password"),t=$("#showPasswordLabel");"password"===e.attr("type")?(e.attr("type","text"),t.css("background-image","url('files/resources/images/open_eye.png')")):(e.attr("type","password"),t.css("background-image","url('files/resources/images/closed_eye.png')"))}))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("login-form");e&&e.addEventListener("submit",login)}));var onloadCallback=function(){widgetId1=grecaptcha.render("example1",{sitekey:window.RECAPTCHA_SITE_KEY,theme:"light",callback:function(e){document.querySelector("#login-form button[type='submit']").disabled=!1},"expired-callback":function(){document.querySelector("#login-form button[type='submit']").disabled=!0}})};function login(e){if(e.preventDefault(),!window.loginIsSubmitting){window.loginIsSubmitting=!0;var t=document.querySelector("#login-form button[type='submit']");t.disabled=!0;var o=document.getElementById("username"),n=document.getElementById("password"),r=o.value,i=n.value;if("undefined"==typeof grecaptcha||void 0===widgetId1)return Alert.error("Error! reCAPTCHA not loaded. Please refresh the page.","Error",{displayDuration:4e3}),window.loginIsSubmitting=!1,void(t.disabled=!1);var s=grecaptcha.getResponse(widgetId1);if(!s)return Alert.error("Error! Please confirm you are not a robot.","Error",{displayDuration:4e3}),window.loginIsSubmitting=!1,void(t.disabled=!1);var a={userAgent:navigator.userAgent,screenResolution:window.screen.width+"x"+window.screen.height},d={usernameOrEmail:r,password:i,deviceInfo:a,csrf_token:window.CSRF_TOKEN,recaptcha_response:s};fetch("/api/login.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then((e=>e.json())).then((e=>{document.getElementById("response").innerHTML="","success"===e.status?(Alert.success("Success! Wait 4 Seconds Before You Will Move On.","Success",{displayDuration:4e3}),handleSuccessfulLogin()):"error"===e.status&&handleLoginError(e.message,r)})).catch((e=>{handleLoginError("Network error: "+e.message,r)})).finally((()=>{window.loginIsSubmitting=!1,t.disabled=!1,grecaptcha.reset(widgetId1)}))}}function handleLoginError(e,t){"undefined"!=typeof grecaptcha&&void 0!==widgetId1&&grecaptcha.reset(widgetId1),Alert.error("Error! "+e,"Error",{displayDuration:4e3}),"Invalid credentials."!==e&&"User not found."!==e||Alert.info('Info Hint! If you forgot your password, follow this link: <a href="javascript:void(0)" onclick="requestPasswordReset(\''+t+"')\">Reset Password</a>","Info",{displayDuration:4e3})}function getRateLimitMessage(e){return{1:"Too many attempts. Wait 1 minute before trying again.",2:"Too many attempts. Wait 5 minutes before trying again.",3:"Too many attempts. Wait 10 minutes before trying again.",4:"Too many attempts. Wait 15 minutes before trying again."}[e]||"Too many attempts. Please try again later."}function requestPasswordReset(e){e?(Alert.info("Sending password reset code...","Info",{displayDuration:2e3}),fetch("/api/send_verification.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,csrf_token:window.CSRF_TOKEN})}).then((e=>e.json())).then((e=>{"success"===e.status?(Alert.success("Success! Password reset code sent. Redirecting...","Success",{displayDuration:3e3}),setTimeout((()=>{window.location.href="/confirm_email_new"}),2e3)):Alert.error("Error! "+e.message,"Error",{displayDuration:4e3})})).catch((e=>{Alert.error("Error! Failed to send reset code.","Error",{displayDuration:4e3})}))):Alert.error("Error! Please enter your email/username first.","Error",{displayDuration:4e3})}
