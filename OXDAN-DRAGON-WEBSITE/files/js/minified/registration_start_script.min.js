var widgetId1,onloadCallback=function(){widgetId1=grecaptcha.render("example2",{sitekey:window.RECAPTCHA_SITE_KEY,theme:"light"})};function register(e){e.preventDefault();var r=document.getElementById("username"),o=document.getElementById("email"),t=document.getElementById("password"),n=r.value,s=o.value,i=t.value;if(n.includes("@"))Alert.error('Error! Username cannot contain "@" symbol.',"Error",{displayDuration:4e3});else{var a=grecaptcha.getResponse(widgetId1);if(a){var l={username:n,email:s,password:i,csrf_token:window.CSRF_TOKEN,recaptcha_response:a};fetch("../files/php/register.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((e=>e.json())).then((e=>{document.getElementById("response").innerHTML="","success"===e.status?"Email sent successfully."===e.message&&(Alert.success("Success! We sent email verification to your email.","Success",{displayDuration:4e3}),redirectTo("confirm_email")):"error"===e.status&&handleRegistrationError(e.message,s)})).catch((e=>{Alert.error("Error! Something went wrong.","Error",{displayDuration:4e3})}))}else Alert.error("Error! Please confirm you are not a robot.","Error",{displayDuration:4e3})}}function handleRegistrationError(e,r){"undefined"!=typeof grecaptcha&&void 0!==widgetId1&&grecaptcha.reset(widgetId1),Alert.error("Error! "+e,"Error",{displayDuration:4e3}),"Username or email already taken."===e&&Alert.info('Info Hint! If you forgot your password, follow this link: <a href="javascript:void(0)" onclick="requestPasswordReset(\''+r+"')\">Reset Password</a>","Info",{displayDuration:4e3})}function redirectTo(e){const r={confirm_email:"/confirm_email"};r[e]&&(window.location.href=r[e])}function requestPasswordReset(e){e?(Alert.info("Sending password reset code...","Info",{displayDuration:2e3}),fetch("../files/php/send_verification.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,csrf_token:window.CSRF_TOKEN})}).then((e=>e.json())).then((e=>{"success"===e.status?(Alert.success("Success! Password reset code sent. Redirecting...","Success",{displayDuration:3e3}),setTimeout((()=>{window.location.href="/confirm_email_new"}),2e3)):Alert.error("Error! "+e.message,"Error",{displayDuration:4e3})})).catch((e=>{Alert.error("Error! Failed to send reset code.","Error",{displayDuration:4e3})}))):Alert.error("Error! Please enter your email/username first.","Error",{displayDuration:4e3})}function initializeGoogleLogin(){if(!window.OAUTH_STATE)return;const e=setInterval((()=>{window.google&&google.accounts&&google.accounts.id&&(clearInterval(e),startGoogleLogin())}),50)}function startGoogleLogin(){const e=window.OAUTH_STATE;google.accounts.id.initialize({client_id:"204106058046-1f2lr09dtrsl6f1j26mvmtj8jut7p7tl.apps.googleusercontent.com",callback:handleCredentialResponse,state:e}),google.accounts.id.renderButton(document.getElementById("google-login-btn"),{theme:"outline",size:"large"})}function handleCredentialResponse(e){const r=window.OAUTH_STATE;fetch("files/php/oauth_google.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:e.credential,state:r})}).then((e=>e.json())).then((e=>{"success"===e.status?window.location.href="/start":alert("Google login failed: "+e.message)}))}$(document).ready((function(){$("#register_form").on("submit",register),$("#showPasswordLabel").on("click",(function(){var e=$("#password"),r=$("#showPasswordLabel");"password"===e.attr("type")?(e.attr("type","text"),r.css("background-image","url('files/resources/images/open_eye.png')")):(e.attr("type","password"),r.css("background-image","url('files/resources/images/closed_eye.png')"))})),initializeGoogleLogin()}));