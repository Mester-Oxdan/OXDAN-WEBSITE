async function confirm_email(e){e.preventDefault();const t={code:document.getElementById("code").value,csrf_token:window.CSRF_TOKEN};fetch("/api/confirm_email.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{const t=document.getElementById("response");if(t.innerHTML="","success"===e.status){const n=document.createElement("h2"),o=document.createElement("h2"),s=new Audio("../files/resources/musics/undertale.mp3");function r(e){window.location.href={start:"/start"}[e]}Alert.success("Success! Registration successful.","Success",{displayDuration:4e3}),n.textContent="!Registration Successful!",o.textContent="Press any key to continue",t.appendChild(n),t.appendChild(o),s.play(),document.addEventListener("keydown",(()=>r("start"))),document.addEventListener("mousedown",(()=>r("start")))}else"blocked"===e.status?(startBlockedCountdown(e.remaining),Alert.error(e.message,"Blocked",{displayDuration:4e3})):"error"===e.status&&("Error wrong code."===e.message?Alert.error("Error! Wrong Code.","Error",{displayDuration:4e3}):"User not found."===e.message?Alert.error("Error! User Not Found.","Error",{displayDuration:4e3}):"Invalid request method."===e.message?Alert.error("Error! Invalid Request Method.","Error",{displayDuration:4e3}):"Error opening file."===e.message?Alert.error("Error! Connecting To Database.","Error",{displayDuration:4e3}):"Error writing to file."===e.message?Alert.error("Error! Writing To Database.","Error",{displayDuration:4e3}):"Too many attempts for confirm_email_1"===e.message?Alert.error("Error! Too Many Attempts. Wait 1 minute before trying again.","Error",{displayDuration:4e3}):"Too many attempts for confirm_email_2"===e.message?Alert.error("Error! Too Many Attempts. Wait 5 minute before trying again.","Error",{displayDuration:4e3}):"Too many attempts for confirm_email_3"===e.message?Alert.error("Error! Too Many Attempts. Wait 10 minute before trying again.","Error",{displayDuration:4e3}):"Too many attempts for confirm_email_4"===e.message?Alert.error("Error! Too Many Attempts. Wait 15 minute before trying again.","Error",{displayDuration:4e3}):Alert.error("Error! Email Confirmation Failed.","Error",{displayDuration:6e3}))})).catch((e=>{Alert.error("Error! Something Went Wrong.","Error",{displayDuration:4e3})}))}let blockedInterval=null;function startBlockedCountdown(e){const t=document.getElementById("code"),r=document.getElementById("confirm-btn");t.disabled=!0,r.disabled=!0,blockedInterval=setInterval((()=>{e--,t.placeholder=`Blocked. Try again in ${e}s`,e<=0&&(clearInterval(blockedInterval),t.disabled=!1,r.disabled=!1,t.placeholder="Enter your code")}),1e3)}let countdownSeconds=60,countdownInterval=null;function startCountdown(){const e=document.getElementById("countdown"),t=document.getElementById("resend-timer"),r=document.getElementById("resend-link");r.classList.add("disabled","hidden"),r.style.pointerEvents="none",r.style.opacity="0.5",t.classList.remove("hidden"),countdownSeconds=60,e.textContent=countdownSeconds,countdownInterval&&clearInterval(countdownInterval),countdownInterval=setInterval((()=>{countdownSeconds--,e.textContent=countdownSeconds,countdownSeconds<=0&&(clearInterval(countdownInterval),t.classList.add("hidden"),r.classList.remove("hidden","disabled"),r.style.pointerEvents="auto",r.style.opacity="1")}),1e3)}function resendEmail(){const e=document.getElementById("resend-link");e.classList.add("disabled"),e.style.pointerEvents="none",e.style.opacity="0.5",fetch("/api/resend_email.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"confirm",csrf_token:window.CSRF_TOKEN})}).then((e=>e.json())).then((t=>{"success"===t.status?(Alert.success("New Confirmation Email Sent Successfully.","Success",{displayDuration:4e3}),startCountdown()):(Alert.error("Error! "+(t.message||"Failed To Resend Email."),"Error",{displayDuration:4e3}),e.classList.remove("disabled"),e.style.pointerEvents="auto",e.style.opacity="1")})).catch((t=>{Alert.error("Error! Something Went Wrong.","Error",{displayDuration:4e3}),e.classList.remove("disabled"),e.style.pointerEvents="auto",e.style.opacity="1"}))}document.addEventListener("DOMContentLoaded",(()=>{startCountdown();const e=document.getElementById("resend-link");e.addEventListener("click",(()=>{e.classList.contains("disabled")||e.classList.contains("hidden")?Alert.info("Please Wait Until Timer Finishes.","Info",{displayDuration:2500}):resendEmail()}))}));
